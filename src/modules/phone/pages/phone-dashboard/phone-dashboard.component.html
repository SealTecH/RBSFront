<mat-spinner class="page-spinner" *ngIf="loading$ | async"></mat-spinner>
<ng-container *ngIf="(loading$ | async)===false">
  <div>
    <mat-form-field appearance="fill" class="search-control">
      <mat-label>Search</mat-label>
      <input matInput class="search-control" [formControl]="searchControl" placeholder="search">
    </mat-form-field>
    <button mat-raised-button class="navigation-btn" color="warn" [disabled]="!searchControl.value" (click)="clearSearch()"> Clear </button>
  </div>
  <ng-container [ngTemplateOutlet]="(mobileMode$| async) ? table: slider" [ngTemplateOutletContext]="{ repair: carouselItem$| async}"></ng-container>
</ng-container>
<ng-template #table>
  <ng-container [ngTemplateOutlet]="buttonsContainer"></ng-container>
  <div>
    <table mat-table [dataSource]="repairsFiltered$ | async" class="mat-elevation-z8">

      <ng-container matColumnDef="model">
        <th mat-header-cell *matHeaderCellDef class="model-cell"> Model </th>
        <td mat-cell *matCellDef="let repair" class="model-cell">
          {{ repair.manufacturer }} <br>
          {{ repair.model }} <br>
          {{ repair.phoneNumber }}
        </td>
      </ng-container>

      <ng-container matColumnDef="malfunction">
        <th mat-header-cell *matHeaderCellDef> Malfunction </th>
        <td mat-cell *matCellDef="let repair"> {{ repair.malfunction }} </td>
      </ng-container>

      <ng-container matColumnDef="cost">
        <th mat-header-cell *matHeaderCellDef class="cost-cell"> Cost </th>
        <td mat-cell *matCellDef="let repair" class="cost-cell">
          {{repair.cost}}
        </td>
      </ng-container>

      <ng-container matColumnDef="created">
        <th mat-header-cell *matHeaderCellDef class="date-cell"> Created Date </th>
        <td mat-cell *matCellDef="let repair" class="date-cell">
          {{ getDate(repair.createDate)}}
        </td>
      </ng-container>

      <ng-container matColumnDef="comments">
        <th mat-header-cell *matHeaderCellDef> Comments </th>
        <td mat-cell *matCellDef="let repair">
          {{ repair.comments }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef class="status-cell"> Status </th>
        <td mat-cell *matCellDef="let repair" class="status-cell">
          {{ repair.status }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns"></tr>
      <tr mat-row [class.selected]="row.id===selectedRow?.id"
          [class.ready]="row.status===RepairStatus.Done && row.id!==selectedRow?.id"
          [class.inProgress]="row.status===RepairStatus.InProgress && row.id!==selectedRow?.id"
          *matRowDef="let row; columns: columns;" (click)="selectRow(row)" ></tr>

      <mat-paginator [pageSizeOptions]="[5, 10, 20]"
                     showFirstLastButtons
                     aria-label="Select page of repairs">
      </mat-paginator>
    </table>
  </div>

</ng-template>

<ng-template #slider let-repair="repair">
  <ng-container [ngTemplateOutlet]="buttonsContainer" [ngTemplateOutletContext]="{repair: repair}"></ng-container>
  <div *ngIf="repair">
    <mat-card (swipeleft)="showNextRepair()" (swiperight)="showPrevRepair()">
      <mat-card-header>
        <mat-card-title>
          <p> Create Date: {{ getDate(repair.createDate) }}</p>
          <p> Cost: {{repair.cost}}</p>
          <p> Status: {{repair.status}} </p>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>{{ repair.manufacturer }}</p>
        <p>{{ repair.model }}</p>
        <p>{{ repair.phoneNumber }}</p>
        <p>{{repair.malfunction}}</p>
        <p> {{ repair.comments }}</p>
        <p> Repair ID:{{repair.id}}</p>
      </mat-card-content>
    </mat-card>
  </div>
</ng-template>

<ng-template #buttonsContainer let-repair="repair">
  <div class="btn-container">
    <button  mat-raised-button class="content-button" (click)="createNewRepair()">New Repair</button>
    <button mat-raised-button class="content-button" color="warn" [disabled]="selectedRow===null && !repair" (click)="deleteRow(repair)">Delete</button>
    <button mat-raised-button class="content-button" [disabled]="selectedRow===null && !repair" (click)="goToDetails(repair)">Details</button>
    <button mat-raised-button class="content-button" [disabled]="selectedRow===null && !repair" (click)="changeStatus(repair)">Change Status</button>
  </div>
  <div class="filters-container">
    <mat-card>
      <mat-card-content>
        <mat-slide-toggle [formControl]="hideDoneControl">Hide Done Repairs</mat-slide-toggle>
      </mat-card-content>
    </mat-card>
  </div>
</ng-template>
